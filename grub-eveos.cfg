# EVE-OS Network Boot Configuration
# This GRUB configuration boots EVE-OS via network installer

set timeout=10
set default=0

# Enable network and HTTP modules
insmod http
insmod linux
insmod initrd
insmod loopback
insmod iso9660
insmod gzio
insmod part_msdos
insmod part_gpt

# Set console output
terminal_output console

menuentry "EVE-OS 14.5.1-lts Network Installer" {
    echo "Loading EVE-OS 14.5.1-lts Network Installer..."
    echo "Server: 192.168.0.4"
    echo "Loading kernel and initrd from installer ISO..."
    
    # Set HTTP root
    set root=(http,192.168.0.4)/14.5.1-lts
    
    # Mount the installer ISO as a loopback device
    loopback loop /installer.iso
    set isoroot=(loop)
    
    # Load kernel and initrd from the ISO
    # EVE-OS typically uses these paths in the installer ISO
    linux (loop)/boot/kernel eve_soft_serial=${net_default_mac} eve_reboot_after_install console=ttyS0,115200n8 console=tty0 root=live:http://192.168.0.4/14.5.1-lts/installer.iso rd.live.image
    initrd (loop)/boot/initrd.img
    
    echo "Booting EVE-OS installer..."
}

menuentry "EVE-OS 14.5.1-lts (Alternative Boot Method)" {
    echo "Loading EVE-OS 14.5.1-lts (Alternative)..."
    
    # Alternative approach: try to boot directly from HTTP
    set root=(http,192.168.0.4)/14.5.1-lts
    
    # Try common EVE-OS kernel paths
    linux /installer.iso root=live:http://192.168.0.4/14.5.1-lts/installer.iso eve_soft_serial=${net_default_mac} eve_reboot_after_install console=ttyS0,115200n8 console=tty0 rd.live.image ip=dhcp
    
    echo "Booting EVE-OS installer (alternative method)..."
}

menuentry "GRUB Shell (Debug)" {
    echo "Dropping to GRUB shell for debugging..."
    echo "Available commands: ls, cat, help, boot, linux, initrd"
    echo "Type 'help' for more commands or 'boot' to try manual boot"
}